

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>synscan.motors &#8212; pysynscan alpha documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pysynscan alpha documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">synscan.motors</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for synscan.motors</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: iso-8859-15 -*-</span>
<span class="c1">#</span>
<span class="c1"># pysynscan</span>
<span class="c1"># Copyright (c) July 2020 Nacho Mas</span>


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">synscan.comm</span> <span class="kn">import</span> <span class="n">comm</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">UDP_IP</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SYNSCAN_UDP_IP&quot;</span><span class="p">,</span><span class="s2">&quot;192.168.4.1&quot;</span><span class="p">)</span>
<span class="n">UDP_PORT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SYNSCAN_UDP_PORT&quot;</span><span class="p">,</span><span class="mi">11880</span><span class="p">))</span>

<span class="n">LOGGING_LEVEL</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SYNSCAN_LOGGING_LEVEL&quot;</span><span class="p">,</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<div class="viewcode-block" id="motors"><a class="viewcode-back" href="../../api.html#synscan.motors.motors">[docs]</a><span class="k">class</span> <span class="nc">motors</span><span class="p">(</span><span class="n">comm</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Implementation of all motor commands and logic</span>
<span class="sd">    following the document:</span>
<span class="sd">    https://inter-static.skywatcher.com/downloads/skywatcher_motor_controller_command_set.pdf</span>

<span class="sd">    **IMPORTANT NOTES** (based on the above doc):</span>

<span class="sd">    * In the motor controller, there is a hardware timer T1 that is used to generate stepping pulse</span>
<span class="sd">      for stepper motor or reference position for servomotor. The input clocks frequency of the timer,</span>
<span class="sd">      plus the preset value of this timer, determine the slewing speed of the motors. </span>

<span class="sd">    * For GOTO mode, the motor controller will take care of T1 automatically. But motion mode has to be set to tracking=False</span>

<span class="sd">    When T1 generates an interrupt, it might:</span>

<span class="sd">        * Drive the motor to move 1 step (1 micro-step or 1 encoder tick) for low speed slewing.</span>
<span class="sd">        * Drive the motor to move up to 32 steps for high speed slewing. This method applies to motor</span>
<span class="sd">          controller firmware version 2.xx. For motor controller with firmware 3.xx or above, the motor</span>
<span class="sd">          controller always drive the motor controller 1 steps/interrupt.</span>


<span class="sd">    Typical session:</span>

<span class="sd">        * Check whether the motor is in full stop status. If not, stop it. </span>
<span class="sd">        * Set the motion mode. </span>
<span class="sd">        * Set the parameters, for example, destination or preset value of T1. </span>
<span class="sd">        * Set the &quot;Start&quot; command. </span>
<span class="sd">        * For a GOTO slewing, check the motor status to confirm that the motor stops (Generally means arriving the destination. ).</span>
<span class="sd">          For a Speed mode slewing, send &quot;Stop&quot; command to end the session. </span>

<span class="sd">    Generally, the motor controller returns to &quot;Speed Mode&quot; when the motor stops automatically. </span>

<span class="sd">    **NOTE:** Methods begining with axis prefix act only onto selected axis.</span>



<span class="sd">    &#39;&#39;&#39;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">udp_ip</span><span class="o">=</span><span class="n">UDP_IP</span><span class="p">,</span><span class="n">udp_port</span><span class="o">=</span><span class="n">UDP_PORT</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Init UDP comunication &#39;&#39;&#39;</span>      
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">:synscanMotor: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">LOGGING_LEVEL</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">motors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">udp_ip</span><span class="p">,</span><span class="n">udp_port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_current_values</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get main motor parameters. Retry if comm fails&#39;&#39;&#39;</span>
        <span class="n">retrySec</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Retriying in </span><span class="si">{</span><span class="n">retrySec</span><span class="si">}</span><span class="s1">..&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retrySec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_degreesPerSecond2T1preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">degreesPerSecond</span><span class="p">):</span>
        <span class="n">countsPerSecond</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">degrees2counts</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">degreesPerSecond</span><span class="p">)</span>
        <span class="n">TMR_Freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;TimerInterruptFreq&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">countsPerSecond</span><span class="p">)</span> <span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">T1preset</span><span class="o">=</span><span class="n">TMR_Freq</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T1preset</span><span class="o">=</span><span class="n">TMR_Freq</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">countsPerSecond</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">T1preset</span>


<div class="viewcode-block" id="motors.get_values"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.get_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameterDict</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Send all cmd in the parameterDict for both axis and return</span>
<span class="sd">        a dictionary with the values.</span>

<span class="sd">        Used by get_parameters and update_current_values functions</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">params</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span><span class="n">cmd</span> <span class="ow">in</span> <span class="n">parameterDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="n">parameter</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">axis</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    <span class="k">raise</span><span class="p">(</span><span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;getValuesError&#39;</span><span class="p">))</span>
            <span class="c1">#Send init done</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="motors.get_parameters"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.get_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get main motor parameters.</span>
<span class="sd">        Some of this parameters are needed for all calculations </span>
<span class="sd">        so they have to be available to the rest of the code</span>

<span class="sd">        Parameters are stored in a dict with te following keys:</span>

<span class="sd">            * countsPerRevolution</span>
<span class="sd">            * TimerInterruptFreq</span>
<span class="sd">            * StepPeriod</span>
<span class="sd">            * MotorBoardVersion</span>
<span class="sd">            * HighSpeedRatio</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">parameterDict</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;countsPerRevolution&#39;</span><span class="p">:</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;TimerInterruptFreq&#39;</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;StepPeriod&#39;</span><span class="p">:</span><span class="s1">&#39;i&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;MotorBoardVersion&#39;</span><span class="p">:</span><span class="s1">&#39;e&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;HighSpeedRatio&#39;</span><span class="p">:</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">parameterDict</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;getParametersError&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MOUNT PARAMETERS: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="motors.axis_get_pos"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_get_pos">[docs]</a>    <span class="k">def</span> <span class="nf">axis_get_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get actual position in Degrees.&#39;&#39;&#39;</span>
        <span class="n">counts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_get_posCounts</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts2degrees</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">counts</span><span class="p">)</span></div>

<div class="viewcode-block" id="motors.axis_set_pos"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_set_pos">[docs]</a>    <span class="k">def</span> <span class="nf">axis_set_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">degrees</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Syncronize position Degrees.&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Syncronizing actual position to </span><span class="si">{</span><span class="n">degrees</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>
        <span class="n">counts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">degrees2counts</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">degrees</span><span class="p">)</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_set_posCounts</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_decode_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hexstring</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Decode Status msg.</span>
<span class="sd">        Status msg is 12bits long (3 HEX digits). </span>
<span class="sd">        </span>
<span class="sd">        HEX digit1 bits:</span>

<span class="sd">        * B0: 1=Tracking,0=Goto</span>
<span class="sd">        * B1: 1=CCW,0=CW</span>
<span class="sd">        * B2: 1=Fast,0=Slow</span>

<span class="sd">        HEX digit2 bits:</span>

<span class="sd">        * B0: 1=Running,0=Stopped</span>
<span class="sd">        * B1: 1=Blocked,0=Normal</span>

<span class="sd">        HEX digit3 bits:</span>

<span class="sd">        * B0: 0 = Not Init,1 = Init done</span>
<span class="sd">        * B1: 1 = Level switch on</span>

<span class="sd">        The decode value is returned as a dictionary with the following keys:</span>

<span class="sd">        * Tracking</span>
<span class="sd">        * CCW</span>
<span class="sd">        * FastSpeed</span>
<span class="sd">        * Stopped</span>
<span class="sd">        * Blocked</span>
<span class="sd">        * InitDone</span>
<span class="sd">        * LevelSwitchOn</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">A</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hexstring</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>       
        <span class="n">B</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hexstring</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">C</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hexstring</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Decode status </span><span class="si">{</span><span class="n">hexstring</span><span class="si">}</span><span class="s1"> A:</span><span class="si">{</span><span class="n">A</span><span class="si">}</span><span class="s1"> B:</span><span class="si">{</span><span class="n">B</span><span class="si">}</span><span class="s1"> C:</span><span class="si">{</span><span class="n">C</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">status</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;Tracking&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">A</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>
        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;CCW&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">bool</span><span class="p">((</span><span class="n">A</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;FastSpeed&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">bool</span><span class="p">((</span><span class="n">A</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;Stopped&#39;</span><span class="p">]</span><span class="o">=</span><span class="ow">not</span><span class="p">(</span><span class="n">B</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>
        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;Blocked&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">bool</span><span class="p">((</span><span class="n">B</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;InitDone&#39;</span><span class="p">]</span><span class="o">=</span><span class="ow">not</span><span class="p">(</span><span class="n">C</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>
        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;LevelSwitchOn&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">bool</span><span class="p">((</span><span class="n">B</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>


<div class="viewcode-block" id="motors.axis_set_motion_mode"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_set_motion_mode">[docs]</a>    <span class="k">def</span> <span class="nf">axis_set_motion_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">Tracking</span><span class="p">,</span><span class="n">CW</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fastSpeed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set Motion Mode.</span>

<span class="sd">        NOTE: Channel will always be set to Tracking Mode after stopped</span>

<span class="sd">        Motion mode msg is 1byte msg (2 HEX digits)</span>

<span class="sd">        HEX Digit 1 bits:</span>

<span class="sd">           * B0: 0=Goto, 1=Tracking</span>
<span class="sd">           * B1: 0=Slow, 1=Fast  (T)</span>
<span class="sd">                 0=Fast, 1=Slow  (G)</span>
<span class="sd">           * B2: 0=S/F, 1=Medium</span>
<span class="sd">           * B3: 1x SlowGoto</span>

<span class="sd">        HEX Digit 2 bits:  </span>

<span class="sd">           * B0: 0=CW,1=CCW</span>
<span class="sd">           * B1: 0=Noth,1=South</span>
<span class="sd">           * B2: 0=Normal Goto,1=Coarse Goto</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Tracking</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fastSpeed</span><span class="p">:</span>
                <span class="n">speedBit</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">speedBit</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fastSpeed</span><span class="p">:</span>
                <span class="n">speedBit</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">speedBit</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">Tracking</span><span class="p">:</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">16</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="o">+</span><span class="n">speedBit</span><span class="o">*</span><span class="mi">32</span><span class="o">+</span><span class="n">CW</span>
        <span class="c1">#Send as two HEX digits</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Setting Motion Mode: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> HEX:</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">02X</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">ndigits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">response</span>        </div>

    <span class="k">def</span> <span class="nf">_set_T1_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set step period for tracking speed&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Setting step_period to: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> counts per seconds&#39;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

<div class="viewcode-block" id="motors.axis_get_posCounts"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_get_posCounts">[docs]</a>    <span class="k">def</span> <span class="nf">axis_get_posCounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get actual postion in StepsCounts.&#39;&#39;&#39;</span>
        <span class="c1">#Position values are offseting by 0x800000</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">)</span><span class="o">-</span><span class="mh">0x800000</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="motors.axis_set_goto_targetCounts"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_set_goto_targetCounts">[docs]</a>    <span class="k">def</span> <span class="nf">axis_set_goto_targetCounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">targetCounts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;GoTo Target value in StepsCounts. Motors has to be stopped&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Setting goto target to </span><span class="si">{</span><span class="n">targetCounts</span><span class="si">}</span><span class="s1"> counts&#39;</span><span class="p">)</span>
        <span class="c1">#Position values are offseting by 0x800000</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">targetCounts</span><span class="o">+</span><span class="mh">0x800000</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="motors.axis_set_goto_targetIncrementCounts"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_set_goto_targetIncrementCounts">[docs]</a>    <span class="k">def</span> <span class="nf">axis_set_goto_targetIncrementCounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">targetCounts</span><span class="p">):</span>
        <span class="c1">#NOT IN USE. HAVE TO BE TESTED!!</span>
        <span class="sd">&#39;&#39;&#39;GoTo Target increment in StepsCounts. Motors has to be stopped&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Setting goto target INCREMENT to </span><span class="si">{</span><span class="n">targetCounts</span><span class="si">}</span><span class="s1"> counts&#39;</span><span class="p">)</span>
        <span class="c1">#Position values are offseting by 0x800000</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">targetCounts</span><span class="o">+</span><span class="mh">0x800000</span><span class="p">)</span>
        <span class="c1">#Set Brake Point Increment</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="mh">0x000DAC</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

    <span class="k">def</span> <span class="nf">axis_wait2stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">):</span>    
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Waitting to stop.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_current_values</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;Status&#39;</span><span class="p">][</span><span class="s1">&#39;Stopped&#39;</span><span class="p">]:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_current_values</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Stopped&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="motors.axis_set_posCounts"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_set_posCounts">[docs]</a>    <span class="k">def</span> <span class="nf">axis_set_posCounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">counts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Syncronize position Counts.&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Syncronizing actual position to </span><span class="si">{</span><span class="n">counts</span><span class="si">}</span><span class="s1"> counts&#39;</span><span class="p">)</span>
        <span class="c1">#Position values are offseting by 0x800000</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">counts</span><span class="o">+</span><span class="mh">0x800000</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="motors.axis_set_goto_target"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_set_goto_target">[docs]</a>    <span class="k">def</span> <span class="nf">axis_set_goto_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">targetDegrees</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;GoTo Target value in Degrees. Motors has to be stopped&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Setting goto target to </span><span class="si">{</span><span class="n">targetDegrees</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>
        <span class="n">posCounts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">degrees2counts</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">targetDegrees</span><span class="p">)</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_set_goto_targetCounts</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">posCounts</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">response</span></div>

    <span class="k">def</span> <span class="nf">axis_goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">targetDegrees</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_stop_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">actualPos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_get_pos</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_motion_mode</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="kc">False</span><span class="p">,(</span><span class="n">targetDegrees</span><span class="o">&lt;</span><span class="n">actualPos</span><span class="p">),</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_goto_target</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">targetDegrees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_start_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

<div class="viewcode-block" id="motors.axis_set_speed"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_set_speed">[docs]</a>    <span class="k">def</span> <span class="nf">axis_set_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">degreesPerSecond</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the tracking speed in degreesPerSecond&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Setting speed to:</span><span class="si">{</span><span class="n">degreesPerSecond</span><span class="si">}</span><span class="s1"> degrees per second&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">degreesPerSecond</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_T1_preset</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_degreesPerSecond2T1preset</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">degreesPerSecond</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Requested speed==0. Stopping axis&#39;</span><span class="p">)</span>
            <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_stop_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

    <span class="k">def</span> <span class="nf">axis_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">speed</span><span class="p">):</span>
        <span class="c1">#Check if we need to stop axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_current_values</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">stopped</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;Status&#39;</span><span class="p">][</span><span class="s1">&#39;Stopped&#39;</span><span class="p">]</span>
        <span class="n">CW</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;Status&#39;</span><span class="p">][</span><span class="s1">&#39;CCW&#39;</span><span class="p">]</span>
        <span class="n">tracking</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;Status&#39;</span><span class="p">][</span><span class="s1">&#39;Tracking&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stopped</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tracking</span> <span class="ow">or</span> <span class="p">(</span><span class="n">CW</span> <span class="ow">and</span> <span class="p">(</span><span class="n">speed</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">CW</span> <span class="ow">and</span> <span class="p">(</span><span class="n">speed</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TRACK asked to change dir or mode tracking:</span><span class="si">{</span><span class="n">tracking</span><span class="si">}</span><span class="s1"> CW:</span><span class="si">{</span><span class="n">CW</span><span class="si">}</span><span class="s1"> speed:</span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_stop_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">syncronous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_motion_mode</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="kc">True</span><span class="p">,(</span><span class="n">speed</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">),</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_speed</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">speed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_start_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
                <span class="k">return</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_speed</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">speed</span><span class="p">)</span>
                <span class="k">return</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_motion_mode</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="kc">True</span><span class="p">,(</span><span class="n">speed</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">),</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_speed</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">speed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_start_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="k">return</span>

<div class="viewcode-block" id="motors.axis_start_motion"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_start_motion">[docs]</a>    <span class="k">def</span> <span class="nf">axis_start_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Start Goto&#39;&#39;&#39;</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Starting motion&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="motors.axis_stop_motion"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.axis_stop_motion">[docs]</a>    <span class="k">def</span> <span class="nf">axis_stop_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">syncronous</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Soft stop. If syncronous==True wait to finish&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Stopping&#39;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">syncronous</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_wait2stop</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: Ask to stop. In progress&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

    <span class="c1">#HIGH LEVEL API (arguments in degrees)</span>
<div class="viewcode-block" id="motors.degrees2counts"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.degrees2counts">[docs]</a>    <span class="k">def</span> <span class="nf">degrees2counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">degrees</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return position or speed in counts for a given deg or deg/seconds value&#39;&#39;&#39;</span>
        <span class="n">CPR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;countsPerRevolution&#39;</span><span class="p">]</span>
        <span class="n">value</span><span class="o">=</span><span class="n">degrees</span><span class="o">*</span><span class="n">CPR</span><span class="o">/</span><span class="mi">360</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="motors.counts2degrees"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.counts2degrees">[docs]</a>    <span class="k">def</span> <span class="nf">counts2degrees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">counts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return position or speed in degrees for a given counts or counts/seconds value&#39;&#39;&#39;</span>
        <span class="n">CPR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;countsPerRevolution&#39;</span><span class="p">]</span>
        <span class="n">value</span><span class="o">=</span><span class="n">counts</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="n">CPR</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="motors.set_switch"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.set_switch">[docs]</a>    <span class="k">def</span> <span class="nf">set_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">on</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Switch on/off auxiliary switch&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">on</span><span class="p">:</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Auxiliary switch: </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_cmd</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">ndigits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="motors.set_pos"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.set_pos">[docs]</a>    <span class="k">def</span> <span class="nf">set_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Syncronize actual position with alpha and beta&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_pos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_pos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">beta</span><span class="p">)</span></div>

<div class="viewcode-block" id="motors.goto"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.goto">[docs]</a>    <span class="k">def</span> <span class="nf">goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">syncronous</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;GOTO. alpha,beta in degrees&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;GOTO axis1=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1"> axis2=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1"> degrees&#39;</span><span class="p">)</span>
        <span class="n">angle</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">alpha</span>
        <span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">beta</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_goto</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">angle</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            self.axis_stop_motion(axis)</span>
<span class="sd">            self.axis_set_motion_mode(axis,False,False,True)</span>
<span class="sd">            self.axis_set_goto_target(axis,angle[axis])</span>
<span class="sd">            self.axis_start_motion(axis)</span>
<span class="sd">            &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">syncronous</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_wait2stop</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="motors.track"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.track">[docs]</a>    <span class="k">def</span> <span class="nf">track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;GOTO. alpha,beta in degrees per second&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TRACK speeds axis1=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1"> axis2=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1"> degrees per seconds&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_track</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_track</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">beta</span><span class="p">)</span></div>

<div class="viewcode-block" id="motors.update_current_values"><a class="viewcode-back" href="../../api.html#synscan.motors.motors.update_current_values">[docs]</a>    <span class="k">def</span> <span class="nf">update_current_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">logaxis</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Update current status and values</span>
<span class="sd">        logaxis can be 1,2,3 or None. 1 for only log current values of axis 1... </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">parameterDict</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;GotoTarget&#39;</span><span class="p">:</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Position&#39;</span><span class="p">:</span><span class="s1">&#39;j&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;StepPeriod&#39;</span><span class="p">:</span><span class="s1">&#39;i&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Status&#39;</span><span class="p">:</span><span class="s1">&#39;f&#39;</span>
                        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">parameterDict</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GotoTarget&#39;</span><span class="p">,</span><span class="s1">&#39;Position&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                <span class="c1">#Position values are offseting by 0x800000</span>
                <span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="n">parameter</span><span class="p">]</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="n">parameter</span><span class="p">]</span><span class="o">-</span><span class="mh">0x800000</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_decode_status</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;Status&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">=</span><span class="n">params</span>
        <span class="k">if</span> <span class="n">logaxis</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logaxis</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">logaxis</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="n">logaxis</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span></div>

    <span class="c1">#Methods for developing</span>
    <span class="k">def</span> <span class="nf">_test_goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Test GOTO. X in degrees&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: GOTO test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_stop_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_motion_mode</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_goto_target</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_start_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_wait2stop</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_test_slew</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">speed</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Test SLEW&#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AXIS</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">: SLEW test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_stop_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_motion_mode</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="kc">True</span><span class="p">,(</span><span class="n">speed</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_set_speed</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_start_motion</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span></div>




<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">smc</span><span class="o">=</span><span class="n">motors</span><span class="p">()</span>
    <span class="n">smc</span><span class="o">.</span><span class="n">set_pos</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#AXIS to test</span>
    <span class="n">AXIS</span><span class="o">=</span><span class="mi">2</span>
    
    <span class="c1">#Test GOTO</span>
    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">smc</span><span class="o">.</span><span class="n">test_goto</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">AXIS</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">smc</span><span class="o">.</span><span class="n">test_goto</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">AXIS</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">#Test SLEW</span>
    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">smc</span><span class="o">.</span><span class="n">test_slew</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">AXIS</span><span class="p">,</span><span class="n">speed</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">smc</span><span class="o">.</span><span class="n">axis_wait2stop</span><span class="p">(</span><span class="n">AXIS</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">#Two axes goto</span>
    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">smc</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">smc</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">#Ramp tracking</span>
    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">smc</span><span class="o">.</span><span class="n">axis_track</span><span class="p">(</span><span class="n">AXIS</span><span class="p">,</span><span class="n">speed</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">smc</span><span class="o">.</span><span class="n">axis_track</span><span class="p">(</span><span class="n">AXIS</span><span class="p">,</span><span class="n">speed</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">smc</span><span class="o">.</span><span class="n">axis_track</span><span class="p">(</span><span class="n">AXIS</span><span class="p">,</span><span class="o">-</span><span class="n">speed</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">smc</span><span class="o">.</span><span class="n">axis_track</span><span class="p">(</span><span class="n">AXIS</span><span class="p">,</span><span class="o">-</span><span class="n">speed</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#GOTO/TRACK interrupts</span>
    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">pass</span>


</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pysynscan alpha documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">synscan.motors</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Nacho Mas.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
  </body>
</html>